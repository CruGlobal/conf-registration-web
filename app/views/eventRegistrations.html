<div class="container full">
  <div class="row">
    <div class="col-sm-7">
      <h2 class="page-title">Registrations</h2>
    </div>
    <div class="col-sm-5 text-right">
      <button class="btn btn-success btn-sm" type="button" ng-click="registerUser()"><i class="fa fa-plus"></i> Add Registration</button>
      <a class="btn btn-primary btn-sm" href="" ng-click="export()"><i class="fa fa-cloud-download"></i> Export</a>
    </div>
  </div>
  <div class="row well well-full spacing-above-xs spacing-below-sm">
    <div class="row">
      <div ng-class="{'col-md-3 col-sm-8': eventHasCost(), 'col-md-5 col-sm-12': !eventHasCost()}" class="stacked-spacing-col-md">
        <label>Search visible columns:</label>
        <input type="text" class="form-control" ng-model="strFilter">
      </div>
      <div class="col-md-2 col-sm-4 stacked-spacing-col-sm" ng-if="eventHasCost()">
        <label>Payment status:</label>
        <select ng-model="queryParameters.filterPayment" class="form-control">
          <option value="">-Any-</option>
          <option value="full">Full/Overpaid</option>
          <option value="partial">Partial</option>
          <option value="full-partial">Full/Partial</option>
          <option value="none">Not Paid</option>
          <option value="over">Overpaid</option>
        </select>
      </div>
      <div class="col-lg-3 col-md-2 col-sm-6 stacked-spacing-col-sm">
        <label>Registration type:</label>
        <select ng-model="queryParameters.filterRegType" ng-options="t.id as t.name for t in visibleFilterRegistrantTypes" class="form-control"></select>
      </div>
      <div class="col-lg-4 col-md-5 col-sm-6 text-right">
        <br>
        <div class="btn-group" role="group">
          <button class="btn btn-default" ng-model="showMoreFilters" btn-checkbox>
            More Filters
            <i class="fa fa-chevron-down" ng-show="!showMoreFilters"></i>
            <i class="fa fa-chevron-up" ng-show="showMoreFilters"></i>
          </button>
          <button class="btn btn-primary" ng-click="refreshRegistrations()"><i class="fa fa-refresh"></i> Refresh</button>
          <button type="button" class="btn btn-primary btn-md dropdown-toggle col-dropdown" ng-model="columnsDropdownToggle" btn-checkbox>
            Columns
            <i class="fa fa-caret-down" ng-show="!columnsDropdownToggle"></i>
            <i class="fa fa-caret-up" ng-show="columnsDropdownToggle"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-right reg-views-dropdown" ng-show="columnsDropdownToggle">
            <li ng-repeat="block in blocks" ng-if="block.profileType !== 'NAME' && block.profileType !== 'EMAIL'">
              <a href="" ng-click="toggleColumn($index)">
                <i class="fa fa-check-square" ng-show="block.visible"></i>
                <i class="fa fa-square-o" ng-show="!block.visible"></i>
                {{block.exportFieldTitle || block.title}}
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="row spacing-above-sm well-border-above" collapse="!showMoreFilters">
      <div class="col-sm-4 stacked-spacing-col-sm">
        <label>Incomplete registrations</label>
        <div class="btn-group btn-group-justified">
          <label class="btn btn-default" ng-model="queryParameters.includeIncomplete" btn-radio="'yes'">Show</label>
          <label class="btn btn-default" ng-model="queryParameters.includeIncomplete" btn-radio="'no'">Hide</label>
          <label class="btn btn-default" ng-model="queryParameters.includeIncomplete" btn-radio="'only'">Only</label>
        </div>
      </div>
      <div class="col-sm-4 stacked-spacing-col-sm">
        <label>Checked-in registrations</label>
        <div class="btn-group btn-group-justified">
          <label class="btn btn-default" ng-model="queryParameters.includeCheckedin" btn-radio="'yes'">Show</label>
          <label class="btn btn-default" ng-model="queryParameters.includeCheckedin" btn-radio="'no'">Hide</label>
          <label class="btn btn-default" ng-model="queryParameters.includeCheckedin" btn-radio="'only'">Only</label>
        </div>
      </div>
      <div class="col-sm-4 stacked-spacing-col-sm">
        <label>Withdrawn registrations</label>
        <div class="btn-group btn-group-justified">
          <label class="btn btn-default" ng-model="queryParameters.includeWithdrawn" btn-radio="'yes'">Show</label>
          <label class="btn btn-default" ng-model="queryParameters.includeWithdrawn" btn-radio="'no'">Hide</label>
          <label class="btn btn-default" ng-model="queryParameters.includeWithdrawn" btn-radio="'only'">Only</label>
        </div>
      </div>
    </div>
  </div>

  <div class="row spacing-below-xs" ng-if="registrants.length > 0">
    <div class="col-sm-8 stacked-spacing-col-sm spacing-xs">
        <pagination total-items="meta.totalRegistrantsFilter" items-per-page="queryParameters.limit" ng-model="queryParameters.page" max-size="5" class="pagination" rotate="false"></pagination>
    </div>
    <div class="col-sm-4 text-right">
      <div class="btn-group">
        <label class="btn btn-default" ng-model="queryParameters.limit" btn-radio="20">20</label>
        <label class="btn btn-default" ng-model="queryParameters.limit" btn-radio="50">50</label>
        <label class="btn btn-default" ng-model="queryParameters.limit" btn-radio="100">100</label>
        <label class="btn btn-default" disabled="disabled">per page</label>
      </div>
    </div>
  </div>
  <div class="row spacing-below-xs" ng-if="registrants.length > 0">
    <div class="col-sm-12">
      Showing {{registrants.length || 0}}<ng-pluralize count="meta.totalRegistrantsFilter" when="{'1': ' of {} registration', 'other': ' of {} registrations'}"></ng-pluralize>
      <ng-pluralize count="meta.totalPages" when="{'0': '', '1': '', 'other': ' on {} pages'}"></ng-pluralize>
    </div>
  </div>

  <div class="row" ng-if="registrants.length === 0">
    <div class="col-xs-12">
      <p>No registrations have been found to match your filter.</p>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12 table-responsive">
      <table class="table" ng-if="registrants.length > 0">
        <thead>
        <tr>
          <th>
            <a href="" ng-click="setOrder('first_name')">First Name</a>
            <i ng-if="queryParameters.orderBy === 'first_name'" class="fa" ng-class="{'fa-caret-down': reversesort, 'fa-caret-up': !reversesort}"></i>
          </th>
          <th>
            <a href="" ng-click="setOrder('last_name')">Last Name</a>
            <i ng-if="queryParameters.orderBy === 'last_name'" class="fa" ng-class="{'fa-caret-down': reversesort, 'fa-caret-up': !reversesort}"></i></th>
          <th>
            <a href="" ng-click="setOrder('email')">Email</a>
            <i ng-if="queryParameters.orderBy === 'email'" class="fa" ng-class="{'fa-caret-down': reversesort, 'fa-caret-up': !reversesort}"></i>
          </th>
          <th ng-repeat="block in blocks | filter:{ visible: true }">
            <a href="" ng-click="setOrder(block.id)">{{block.exportFieldTitle || block.title}}</a>
            <i ng-if="queryParameters.orderBy === block.id" class="fa" ng-class="{'fa-caret-down': reversesort, 'fa-caret-up': !reversesort}"></i>
          </th>
          <th ng-show="conference.registrantTypes.length > 1" class="text-center" width="150">
            <a href="" ng-click="setOrder('registrant_type_id')">Type</a>
            <i ng-if="queryParameters.orderBy === 'registrant_type_id'" class="fa" ng-class="{'fa-caret-down': reversesort, 'fa-caret-up': !reversesort}"></i>
          </th>
          <th class="text-center" width="160">
            <a href="" ng-click="setOrder('created_timestamp')">Started</a>
            <i ng-if="queryParameters.orderBy === 'created_timestamp'" class="fa" ng-class="{'fa-caret-down': reversesort, 'fa-caret-up': !reversesort}"></i>
          </th>
          <th class="text-center" width="160">
            <a href="" ng-click="setOrder('completed_timestamp')">Completed</a>
            <i ng-if="queryParameters.orderBy === 'completed_timestamp'" class="fa" ng-class="{'fa-caret-down': reversesort, 'fa-caret-up': !reversesort}"></i>
          </th>
          <th ng-if="eventHasCost()" class="text-center" width="62">
            Paid
          </th>
          <th class="text-center" width="94">
            <a href="" ng-click="setOrder('checked_in_timestamp')">Checked-in</a>
            <i ng-if="queryParameters.orderBy === 'checked_in_timestamp'" class="fa" ng-class="{'fa-caret-down': reversesort, 'fa-caret-up': !reversesort}"></i></th>
          <th class="text-center" width="146">Options</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat-start="r in registrants | orderBy:answerSort:reversesort" ng-class="{'active': $even}" class="noselect">
          <td ng-click="expandRegistration(r.id)" ng-class="{'strike-through':r.withdrawn}">{{r.firstName}}</td>
          <td ng-click="expandRegistration(r.id)" ng-class="{'strike-through':r.withdrawn}">{{r.lastName}}</td>
          <td ng-click="expandRegistration(r.id)" ng-class="{'strike-through':r.withdrawn}">{{r.email}}</td>
          <td ng-repeat="block in blocks | filter:{ visible: true }" ng-click="expandRegistration(r.id)" ng-class="{'strike-through':r.withdrawn}">
            <show-answer block="block" registrant="r"></show-answer>
          </td>
          <td class="text-center" ng-show="conference.registrantTypes.length > 1" ng-class="{'strike-through':r.withdrawn}" ng-bind="getRegistrantType(r.registrantTypeId).name"></td>
          <td class="text-center" ng-click="expandRegistration(r.id)" ng-class="{'strike-through':r.withdrawn}">
            {{r.createdTimestamp | date: 'short'}}
          </td>
          <td class="text-center" ng-click="expandRegistration(r.id)" ng-class="{'strike-through':r.withdrawn}">
            <span ng-show="getRegistration(r.registrationId).completed">
              {{getRegistration(r.registrationId).completedTimestamp | date: 'short'}}
            </span>
            <span ng-show="!getRegistration(r.registrationId).completed">
              -
            </span>
          </td>
          <td ng-if="eventHasCost()" class="text-center">
            <div ng-if="getRegistration(r.registrationId).completed">
              <button type="button" ng-click="viewPayments(r.registrationId)" class="btn btn-sm" ng-class="{'btn-success': paidInFull(r.registrationId), 'btn-default': !paidInFull(r.registrationId)}" title="View/Edit Payments &amp; Expenses">
                &nbsp;
                <i ng-if="paidInFull(r.registrationId)" class="fa fa-check-square-o"></i>
                <i ng-if="!paidInFull(r.registrationId)" class="fa fa-square-o"></i>
                &nbsp;
              </button>
            </div>
          </td>
          <td class="text-center">
            <button type="button" ng-disabled="r.withdrawn && !r.checkedInTimestamp" ng-click="checkInRegistrant(r, !r.checkedInTimestamp)" class="btn btn-sm" ng-class="{'btn-success': r.checkedInTimestamp, 'btn-default': !r.checkedInTimestamp}" ng-attr-title="{{!r.checkedInTimestamp ? 'Check In' : 'Remove Check In'}}">
              &nbsp;
              <i ng-if="r.checkedInTimestamp" class="fa fa-check-square-o"></i>
              <i ng-if="!r.checkedInTimestamp" class="fa fa-square-o"></i>
              &nbsp;
            </button>
          </td>
          <td class="text-center">
            <div class="btn-group btn-group-sm registration-option-buttons" role="group" aria-label="Options">
              <button type="button" class="btn btn-default" ng-click="editRegistrant(r)" title="Edit Registration">
                <i class="fa fa-edit"></i>
              </button>
              <button type="button" class="btn btn-default" ng-click="withdrawRegistrant(r, !r.withdrawn)" ng-attr-title="{{!r.withdrawn ? 'Withdraw Registration' : 'Reinstate Registration'}}">
                <i ng-if="!r.withdrawn" class="fa fa-sign-out"></i>
                <i ng-if="r.withdrawn" class="fa fa-sign-in"></i>
              </button>
              <button type="button" class="btn btn-danger" ng-click="deleteRegistrant(r)" title="Delete Registration">
                <i class="fa fa-trash-o"></i>
              </button>
              <button type="button" class="btn btn-default" ng-click="expandRegistration(r.id)" title="Expand Registration">
                <i class="fa" ng-class="{'fa-chevron-up': (expandedStatus(r.id) === 'open'), 'fa-chevron-down': !expandedStatus(r.id), 'fa-spinner fa-spin': (expandedStatus(r.id) === 'loading')}"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr ng-repeat-end class="rowdetails on" ng-if="expandedStatus(r.id) === 'open'">
          <td colspan="100%">
            <div class="well">
              <div class="row" ng-repeat="block in blocks" ng-if="blockIsVisible(block, r.registrantTypeId)">
                <div class="col-xs-3 details-heading" ng-bind="block.title"></div>
                <div class="col-xs-9"><show-answer block="block" registrant="r"></show-answer></div>
              </div>
              <div class="row">
                <div class="col-xs-3 details-heading">Started on</div>
                <div class="col-xs-9">{{r.createdTimestamp | evtDateFormat: conference.eventTimezone}}</div>
              </div>
              <div class="row" ng-show="getRegistration(r.registrationId).completed">
                <div class="col-xs-3 details-heading">Completed on</div>
                <div class="col-xs-9">{{getRegistration(r.registrationId).completedTimestamp | evtDateFormat: conference.eventTimezone}}</div>
              </div>
              <div class="row" ng-show="r.withdrawn">
                <div class="col-xs-3 details-heading">Withdrawn on</div>
                <div class="col-xs-9">{{r.withdrawnTimestamp | evtDateFormat: conference.eventTimezone}}</div>
              </div>
              <div class="row" ng-show="r.checkedInTimestamp">
                <div class="leftside">Checked in at</div>
                <div class="rightside">{{r.checkedInTimestamp | evtDateFormat: conference.eventTimezone}}</div>
              </div>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="row spacing-above-xs" ng-if="registrants.length > 0">
    <div class="col-sm-8 stacked-spacing-col-sm spacing-xs">
      <pagination total-items="meta.totalRegistrantsFilter" items-per-page="queryParameters.limit" ng-model="queryParameters.page" max-size="5" class="pagination" rotate="false"></pagination>
    </div>
    <div class="col-sm-4 text-right">
      <div class="btn-group">
        <label class="btn btn-default" ng-model="queryParameters.limit" btn-radio="20">20</label>
        <label class="btn btn-default" ng-model="queryParameters.limit" btn-radio="50">50</label>
        <label class="btn btn-default" ng-model="queryParameters.limit" btn-radio="100">100</label>
        <label class="btn btn-default" disabled="disabled">per page</label>
      </div>
    </div>
  </div>
</div>
