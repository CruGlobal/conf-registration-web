<div class="row spacing-below-md">
  <div class="col-xs-12 form-content">
    <section ng-if="currentRegistration.completed || mergedRegistration">
      <h1 translate>You are registered!</h1>
      <p translate>Keep this information for your records.</p>
      <p ng-if="mergedRegistration" translate>
        Because of technical limitations, now that you have registered with your spouse, you will no longer be able to
        access your registration. Only your spouse will be able to view or make changes to your combined registration.
        Your combined registration is shown here, but you will not be able to access this information again once you
        naviagate away from this page.
      </p>
      <p ng-if="currentRegistration.remainingBalance > 0"><translate>You have a remaining balance of</translate> {{currentRegistration.remainingBalance | currency:'$'}}</p>
      <p ng-if="!mergedRegistration && acceptedPaymentMethods() && currentRegistration.remainingBalance > 0" translate>Please enter your payment information below. Then click {{getConfirmButtonName()}}. That's it!</p>

      <div class="well well-creme2">
        <h2 class="page-title border" class="page-title border details-heading">{{conference.name}}</h2>
        <p ng-bind="conference.description" class="display-linebreaks"></p>

        <strong translate>Event Dates</strong>
        <p>{{conference.eventStartTime | evtDateFormat: conference.eventTimezone}} -
          {{conference.eventEndTime | evtDateFormat: conference.eventTimezone}}</p>

        <strong ng-if="conference.locationName" translate>Event Location</strong>
        <p>{{conference.locationName}}
          <span ng-show="conference.locationAddress"><br>{{conference.locationAddress}}<br>{{conference.locationCity}}, {{conference.locationState}} {{conference.locationZipCode}}</span>
        </p>

        <strong translate>Contact Info</strong>
        <ul class="list-unstyled">
          <li ng-show="conference.contactPersonName">{{conference.contactPersonName}}</li>
          <li ng-show="conference.contactPersonPhone">{{conference.contactPersonPhone}}</li>
          <li ng-show="conference.contactPersonEmail"><a ng-href="mailto:{{conference.contactPersonEmail}}">{{conference.contactPersonEmail}}</a></li>
        </ul>
      </div>
    </section>
    <section class="reg-not-complete" ng-if="!currentRegistration.completed && !mergedRegistration">
      <h3><translate>Your registration is not complete</translate>...</h3>
      <br />
      <p ng-if="!acceptedPaymentMethods() || currentRegistration.calculatedTotalDue === 0" translate>Almost done. Please review your registration details below and click {{getConfirmButtonName()}} if correct. That's it!</p>
      <p ng-if="acceptedPaymentMethods() && currentRegistration.calculatedTotalDue > 0" translate>Almost done. Please review your registration details and enter your payment information below. Then click {{getConfirmButtonName()}}. That's it!</p>
    </section>
  </div>
</div>

<div class="row">
  <div class="col-xs-12 form-content">
    <section>
      <h2 class="page-title border" translate>Registration Review</h2>
      <table class="table review-breakdown">
        <thead>
          <tr>
            <th width="10"></th>
            <th translate>Registrant</th>
            <th width="110"><span ng-if="conference.registrantTypes.length > 1" translate>Type</span></th>
            <th width="150"></th>
          </tr>
        </thead>
        <tbody ng-repeat="r in currentRegistration.registrants | orderBy: 'createdTimestamp'" ng-init="expandRegistrant[r.id] = regValidate[r.id].length > 0">
          <tr>
            <td ng-click="expandRegistrant[r.id] = !expandRegistrant[r.id]">
              <i class="fa" ng-class="{'fa-plus-square-o': !expandRegistrant[r.id], 'fa-minus-square-o': expandRegistrant[r.id]}"></i>
            </td>
            <td ng-class="{'invalidBlock': regValidate[r.id].length}">{{r.firstName}} {{r.lastName}}</td>
            <td ng-class="{'invalidBlock': regValidate[r.id].length}">
              <span ng-if="conference.registrantTypes.length > 1">{{getRegistrantType(r.registrantTypeId).name}}</span>
            </td>
            <td class="text-right" ng-if="!mergedRegistration">
              <input type="button" class="btn btn-sm btn-default btn-bold" ng-click="editRegistrant(r.id)" value="Edit"
                     ng-if="!currentRegistration.completed || (currentRegistration.completed && conference.allowEditRegistrationAfterComplete)">
              <input type="button" class="btn btn-sm btn-danger btn-bold" ng-click="removeRegistrant(r.id)" ng-if="registrantDeletable(r)" value="Remove">
            </td>
          </tr>
          <tr ng-repeat="block in blocks" ng-if="blockVisibleForRegistrant(block, r)" ng-show="expandRegistrant[r.id]">
            <td></td>
            <td style="font-weight:bold;" ng-class="{'invalidBlock': isBlockInvalid(r.id, block.id)}" ng-bind-html="block.title"></td>
            <td colspan="2"><show-answer block="block" registrant="r" show-amount="true"></show-answer></td>
          </tr>
        </tbody>
      </table>
    </section>
    <section ng-if="allowGroupRegistration && (!currentRegistration.completed || conference.allowEditRegistrationAfterComplete) && !mergedRegistration" class="hidden-print">
      <h2 class="page-title border" translate>Add a Family Member</h2>
      <registration-type-select></registration-type-select>
    </section>
    <section>
      <h2 class="page-title border" translate>Summary</h2>
      <p>
        <translate>A breakdown of the costs</translate>
        <span ng-show="currentRegistration.pastPayments.length > 0" translate>and payments</span>
        <translate>associated with your registration.</translate>
      </p>
      <table class="table review-breakdown">
        <thead>
          <tr>
            <th width="10"></th>
            <th translate>Registrant</th>
            <th width="90" translate>Cost</th>
          </tr>
        </thead>
        <tbody ng-repeat="r in currentRegistration.registrants | orderBy: 'createdTimestamp'">
          <tr ng-click="expandRegistrantCost[r.id] = !expandRegistrantCost[r.id]">
            <td>
              <i class="fa" ng-class="{'fa-plus-square-o': !expandRegistrantCost[r.id], 'fa-minus-square-o': expandRegistrantCost[r.id]}"></i>
            </td>
            <td>{{r.firstName}} {{r.lastName}}</td>
            <td><span ng-if="!expandRegistrantCost[r.id]">{{r.calculatedTotalDue | currency:'$'}}</span></td>
          </tr>
          <tr ng-if="expandRegistrantCost[r.id]">
            <td></td>
            <td class="horizon-padding25"><i class="fa fa-angle-right"></i> <translate>Registration</translate></td>
            <td>{{getRegistrantType(r.registrantTypeId).cost | currency:'$'}}</td>
          </tr>
          <tr ng-repeat="a in r.answers" ng-if="a.amount !== 0 && expandRegistrantCost[r.id]">
            <td></td>
            <td class="horizon-padding25"><i class="fa fa-angle-right"></i> {{getBlock(a.blockId).title}}: <show-answer block="getBlock(a.blockId)" registrant="r"></show-answer></td>
            <td>{{a.amount | currency:'$'}}</td>
          </tr>
          <tr ng-if="expandRegistrantCost[r.id] && r.calculatedEarlyRegistrationDiscounts">
            <td></td>
            <td class="horizon-padding25"><i class="fa fa-angle-right"></i> <translate>Early Registration Discount</translate></td>
            <td>{{(r.calculatedEarlyRegistrationDiscounts * -1) | currency:'$'}}</td>
          </tr>
          <tr ng-if="expandRegistrantCost[r.id] && r.calculatedPromotionDiscounts">
            <td></td>
            <td class="horizon-padding25"><i class="fa fa-angle-right"></i> <translate>Promotion Discount</translate></td>
            <td>{{(r.calculatedPromotionDiscounts * -1) | currency:'$'}}</td>
          </tr>
        </tbody>
      </table>

      <div class="row">
        <div class="col-sm-6 col-sm-offset-6">
          <table class="table pull-right">
            <tr ng-if="currentRegistration.calculatedPromotionDiscounts">
              <th translate>Promotion Discount</th>
              <td width="90">{{(currentRegistration.calculatedPromotionDiscounts * -1) | currency:'$'}}</td>
            </tr>
            <tr>
              <th translate>Total</th>
              <td width="90">{{currentRegistration.calculatedTotalDue | currency:'$'}}</td>
            </tr>
            <tr ng-repeat="p in currentRegistration.pastPayments">
              <td>
                <strong>{{p.paymentType | paymentTypeFormat}}</strong>
                <span ng-if="p.paymentType !== 'TRANSFER'">({{p.transactionDatetime | date: 'shortDate'}})</span>
                <span ng-if="p.status === 'PENDING' || p.status === 'REQUESTED'">*</span>
              </td>
              <td>
                <span ng-if="p.paymentType === 'REFUND'">
                  {{p.amount | currency:'$'}}
                </span>
                <span ng-if="p.paymentType !== 'REFUND'">
                  {{(p.amount * -1) | currency:'$'}}
                </span>
              </td>
            </tr>
            <tr ng-show="currentRegistration.pastPayments.length > 0">
              <th translate>Remaining Balance</th>
              <td>{{(currentRegistration.remainingBalance) | currency:'$'}}</td>
            </tr>
          </table>
          <p class="text-muted" ng-if="hasPendingPayments(currentRegistration.pastPayments)" translate>* Pending payments are not reflected in remaining balance. Your remaining balance will be automatically updated once any scholarships are approved or checks have been received.</p>

          <table class="table">
            <tr ng-repeat="p in currentRegistration.promotions">
              <td>{{p.code}} <span class="text-muted" ng-if="p.description">{{p.description}}</span></td>
              <td class="text-center" width="80">
                <button ng-click="deletePromotion(p.id)" title="Delete Promotion" class="btn btn-xs btn-danger"><i class="fa fa-trash-o"></i></button>
              </td>
            </tr>
          </table>

          <a href="" ng-click="showPromoInput = true" ng-show="!currentRegistration.completed && currentRegistration.remainingBalance > 0 && conference.promotions.length && !showPromoInput">
            <i class="fa fa-plus"></i> <translate>Add Promotion Code</translate>
          </a>
          <div class="input-group" ng-show="showPromoInput">
            <input type="text" class="form-control" ng-model="promoInput" ng-enter="validatePromo(promoInput)">
            <span class="input-group-btn">
              <button type="button" class="btn btn-default" ng-click="validatePromo(promoInput)" ng-disabled="addingPromoCode" translate>Validate</button>
            </span>
          </div>
        </div>
      </div>

      <div ng-if="hasPendingCheckPayment(currentRegistration.pastPayments)" class="spacing-below-md">
        <h2 class="page-title border" translate>Check Instructions</h2>
        <ol>
          <li translate>Print this page.</li>
          <li><translate>Make your check payable to</translate> "{{conference.checkPayableTo}}".</li>
          <li><translate>Mail this page and your check to:</translate><br><br>
            {{conference.checkMailingAddress}}<br>
            {{conference.checkMailingCity}}, {{conference.checkMailingState}} {{conference.checkMailingZip}}
          </li>
        </ol>
      </div>

      <div ng-if="acceptedPaymentMethods() && currentRegistration.remainingBalance > 0 && !mergedRegistration" class="hidden-print">
        <h2 class="page-title border" translate>Payment</h2>
        <div ert-payment payment="currentPayment" registration="currentRegistration" payment-methods="acceptedPaymentMethods"></div>
      </div>
    </section>

    <section class="text-center spacing-above-md hidden-print" ng-if="(!currentRegistration.completed || (acceptedPaymentMethods() && currentRegistration.remainingBalance > 0)) && !spouseRegistration">
      <p ng-if="!allRegistrantsValid()" style="color:red;" translate>Please fill in all required fields in red before submitting.</p>
      <input type="button" class="btn btn-lg btn-success btn-important confirm-registration" ng-click="confirmRegistration()" value="Confirm" ng-disabled="registerDisabled()">
      <span ng-show="registerMode === 'preview'">&laquo; <translate>Disabled in preview mode</translate></span>
    </section>

    <section class="text-center spacing-above-md hidden-print" ng-if="!currentRegistration.completed && spouseRegistration && !mergedRegistration">
      <h2 class="page-title border text-left" translate>Spouse Registration</h2>
      <div class="hidden-print">
        <p ng-if="alreadyRegistered" translate>
          Your spouse <strong>{{spouseName}}</strong> has already registered both themselves and you for this conference.<br/>
          Are you sure you want to register again?
        </p>
        <p ng-if="!alreadyRegistered" translate>
          Your spouse <strong>{{spouseName}}</strong> has already registered for this conference.<br/>
          Would you like to add your registration to your spouse's existing registration?
        </p>
        <p ng-if="!allRegistrantsValid()" style="color:red;" translate>Please fill in all required fields in red before submitting.</p>
        <div class="text-center spacing-above-md hidden-print">
          <button class="btn btn-lg btn-important btn-success merge-registrations" ng-click="mergeAndConfirmRegistration()" ng-disabled="registerDisabled()" ng-if="!alreadyRegistered" translate>Register Together</button>
          <button class="btn btn-lg btn-important btn-success confirm-registration" ng-click="confirmRegistration()" ng-disabled="registerDisabled()" ng-if="!alreadyRegistered" translate>Register Separately</button>
          <button class="btn btn-lg btn-important btn-warning confirm-registration" ng-click="confirmRegistration()" ng-disabled="registerDisabled()" ng-if="alreadyRegistered" translate>Register Again</button>
        </div>
      </div>
    </section>

    <section class="text-center hidden-print" ng-if="currentRegistration.completed">
      <div class="spacing-above-md" ng-if="mergedRegistration && conference.registrationCompleteRedirect">
        <a ng-href="{{conference.registrationCompleteRedirect}}" class="btn btn-success">Go to conference page</a>
      </div>
      <div class="spacing-above-md">
        <input type="button" class="btn btn-primary" onClick="window.print();" value="Print this page">
      </div>
    </section>
  </div>
</div>
