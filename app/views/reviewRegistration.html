<div class="row spacing-below-md">
  <div class="col-xs-12 form-content">
    <section ng-if="currentRegistration.completed">
      <h1>You are registered!</h1>
      <p>Keep this information for your records.</p>
      <p ng-if="currentRegistration.remainingBalance > 0">You have a remaining balance of {{currentRegistration.remainingBalance | currency:'$'}}</p>
      <p ng-if="acceptedPaymentMethods() && currentRegistration.remainingBalance > 0">Please enter your payment information below.  Then click Confirm.  That's it!</p>

      <div class="well well-creme2">
        <h2 class="page-title border" class="page-title border details-heading">{{conference.name}}</h2>
        <p ng-bind="conference.description" class="display-linebreaks"></p>

        <strong>Event Dates</strong>
        <p>{{conference.eventStartTime | evtDateFormat: conference.eventTimezone}} -
          {{conference.eventEndTime | evtDateFormat: conference.eventTimezone}}</p>

        <strong ng-if="conference.locationName">Event Location</strong>
        <p>{{conference.locationName}}
          <span ng-show="conference.locationAddress"><br>{{conference.locationAddress}}<br>{{conference.locationCity}}, {{conference.locationState}} {{conference.locationZipCode}}</span>
        </p>

        <strong>Contact Info</strong>
        <ul class="list-unstyled">
          <li ng-show="conference.contactPersonName">{{conference.contactPersonName}}</li>
          <li ng-show="conference.contactPersonPhone">{{conference.contactPersonPhone}}</li>
          <li ng-show="conference.contactPersonEmail"><a ng-href="mailto:{{conference.contactPersonEmail}}">{{conference.contactPersonEmail}}</a></li>
        </ul>
      </div>
    </section>
    <section class="reg-not-complete" ng-if="!currentRegistration.completed">
      <h3>Your registration is not complete...</h3>
      <br />
      <p ng-if="!acceptedPaymentMethods() || currentRegistration.calculatedTotalDue === 0">Almost done. Please review your registration details below and click Confirm if correct. That's it!</p>
      <p ng-if="acceptedPaymentMethods() && currentRegistration.calculatedTotalDue > 0">Almost done. Please review your registration details and enter your payment information below.  Then click Confirm.  That's it!</p>
    </section>
  </div>
</div>

<div class="row">
  <div class="col-xs-12 form-content">
    <section>
      <h2 class="page-title border">Registration Review</h2>
      <table class="table review-breakdown">
        <thead>
          <tr>
            <th width="10"></th>
            <th>Registrant</th>
            <th width="110"><span ng-if="conference.registrantTypes.length > 1">Type</span></th>
            <th width="150"></th>
          </tr>
        </thead>
        <tbody ng-repeat="r in currentRegistration.registrants | orderBy: 'createdTimestamp'" ng-init="expandRegistrant[r.id] = regValidate[r.id].length > 0">
          <tr>
            <td ng-click="expandRegistrant[r.id] = !expandRegistrant[r.id]">
              <i class="fa" ng-class="{'fa-plus-square-o': !expandRegistrant[r.id], 'fa-minus-square-o': expandRegistrant[r.id]}"></i>
            </td>
            <td ng-class="{'invalidBlock': regValidate[r.id].length}">{{r.firstName}} {{r.lastName}}</td>
            <td ng-class="{'invalidBlock': regValidate[r.id].length}">
              <span ng-if="conference.registrantTypes.length > 1">{{getRegistrantType(r.registrantTypeId).name}}</span>
            </td>
            <td class="text-right">
              <input type="button" class="btn btn-sm btn-default btn-bold" ng-click="editRegistrant(r.id)" value="Edit"
                     ng-if="!currentRegistration.completed || (currentRegistration.completed && conference.allowEditRegistrationAfterComplete)">
              <input type="button" class="btn btn-sm btn-danger btn-bold" ng-click="removeRegistrant(r.id)" ng-if="registrantDeletable(r)" value="Remove">
            </td>
          </tr>
          <tr ng-repeat="block in blocks" ng-if="blockVisibleForRegistrant(block, r)" ng-show="expandRegistrant[r.id]">
            <td></td>
            <td style="font-weight:bold;" ng-class="{'invalidBlock': isBlockInvalid(r.id, block.id)}">{{block.title}}</td>
            <td colspan="2"><show-answer block="block" registrant="r" show-amount="true"></show-answer></td>
          </tr>
        </tbody>
      </table>
    </section>
    <section ng-if="allowGroupRegistration && (!currentRegistration.completed || conference.allowEditRegistrationAfterComplete)">
      <h2 class="page-title border">Add a Family Member</h2>
      <registration-type-select></registration-type-select>
    </section>
    <section>
      <h2 class="page-title border">Summary</h2>
      <p>A breakdown of the costs<span ng-show="currentRegistration.pastPayments.length > 0"> and payments</span> associated with your registration.</p>
      <table class="table review-breakdown">
        <thead>
          <tr>
            <th width="10"></th>
            <th>Registrant</th>
            <th width="90">Cost</th>
          </tr>
        </thead>
        <tbody ng-repeat="r in currentRegistration.registrants | orderBy: 'createdTimestamp'">
          <tr ng-click="expandRegistrantCost[r.id] = !expandRegistrantCost[r.id]">
            <td>
              <i class="fa" ng-class="{'fa-plus-square-o': !expandRegistrantCost[r.id], 'fa-minus-square-o': expandRegistrantCost[r.id]}"></i>
            </td>
            <td>{{r.firstName}} {{r.lastName}}</td>
            <td><span ng-show="!expandRegistrantCost[r.id]">{{r.calculatedTotalDue | currency:'$'}}</span></td>
          </tr>
          <tr ng-show="expandRegistrantCost[r.id]">
            <td></td>
            <td class="horizon-padding25"><i class="fa fa-angle-right"></i> Registration</td>
            <td>{{getRegistrantType(r.registrantTypeId).cost | currency:'$'}}</td>
          </tr>
          <tr ng-repeat="a in r.answers" ng-if="a.amount > 0" ng-show="expandRegistrantCost[r.id]">
            <td></td>
            <td class="horizon-padding25"><i class="fa fa-angle-right"></i> {{getBlock(a.blockId).title}}: <show-answer block="getBlock(a.blockId)" registrant="r"></show-answer></td>
            <td>{{a.amount | currency:'$'}}</td>
          </tr>
          <tr ng-show="expandRegistrantCost[r.id] && r.calculatedEarlyRegistrationDiscounts">
            <td></td>
            <td class="horizon-padding25"><i class="fa fa-angle-right"></i> Early Registration Discount</td>
            <td>{{(r.calculatedEarlyRegistrationDiscounts * -1) | currency:'$'}}</td>
          </tr>
          <tr ng-show="expandRegistrantCost[r.id] && r.calculatedPromotionDiscounts">
            <td></td>
            <td class="horizon-padding25"><i class="fa fa-angle-right"></i> Promotion Discount</td>
            <td>{{(r.calculatedPromotionDiscounts * -1) | currency:'$'}}</td>
          </tr>
        </tbody>
      </table>

      <div class="row">
        <div class="col-sm-6 col-sm-offset-6">
          <table class="table pull-right">
            <tr ng-if="currentRegistration.calculatedPromotionDiscounts">
              <th>Promotion Discount</th>
              <td width="90">{{(currentRegistration.calculatedPromotionDiscounts * -1) | currency:'$'}}</td>
            </tr>
            <tr>
              <th>Total</th>
              <td width="90">{{currentRegistration.calculatedTotalDue | currency:'$'}}</td>
            </tr>
            <tr ng-repeat="p in currentRegistration.pastPayments">
              <td>
                <strong>{{p.paymentType | paymentTypeFormat}}</strong>
                <span ng-if="p.paymentType !== 'TRANSFER'">({{p.transactionDatetime | date: 'shortDate'}})</span>
                <span ng-if="p.status === 'PENDING' || p.status === 'REQUESTED'">*</span>
              </td>
              <td>
                <span ng-if="p.paymentType === 'REFUND'">
                  {{p.amount | currency:'$'}}
                </span>
                <span ng-if="p.paymentType !== 'REFUND'">
                  {{(p.amount * -1) | currency:'$'}}
                </span>
              </td>
            </tr>
            <tr ng-show="currentRegistration.pastPayments.length > 0">
              <th>Remaining Balance</th>
              <td>{{(currentRegistration.remainingBalance) | currency:'$'}}</td>
            </tr>
          </table>
          <p class="text-muted" ng-if="hasPendingPayments(currentRegistration.pastPayments)">* Pending payments are not reflected in remaining balance. Your remaining balance will be automatically updated once any scholarships are approved or checks have been received.</p>

          <table class="table">
            <tr ng-repeat="p in currentRegistration.promotions">
              <td>{{p.code}} <span class="text-muted" ng-if="p.description">{{p.description}}</span></td>
              <td class="text-center" width="80">
                <button ng-click="deletePromotion(p.id)" title="Delete Promotion" class="btn btn-xs btn-danger"><i class="fa fa-trash-o"></i></button>
              </td>
            </tr>
          </table>

          <a href="" ng-click="showPromoInput = true" ng-show="!currentRegistration.completed && currentRegistration.remainingBalance > 0 && conference.promotions.length && !showPromoInput">
            <i class="fa fa-plus"></i> Add Promotion Code
          </a>
          <div class="input-group" ng-show="showPromoInput">
            <input type="text" class="form-control" ng-model="promoInput" ng-enter="validatePromo(promoInput)">
            <span class="input-group-btn">
              <button type="button" class="btn btn-default" ng-click="validatePromo(promoInput)" ng-disabled="addingPromoCode">Validate</button>
            </span>
          </div>
        </div>
      </div>

    <div ng-if="acceptedPaymentMethods() && currentRegistration.remainingBalance > 0">
        <h2 class="page-title border">Payment</h2>
      <div ert-payment payment="currentPayment" registration="currentRegistration" payment-methods="acceptedPaymentMethods"></div>
    </div>
    </section>
    <section class="text-center spacing-above-md" ng-if="!currentRegistration.completed || (acceptedPaymentMethods() && currentRegistration.remainingBalance > 0)">
      <p ng-if="!allRegistrantsValid()" style="color:red;">Please fill in all required fields in red before submitting.</p>
      <input type="button" class="btn btn-lg btn-success btn-important confirm-registration" ng-click="confirmRegistration()" value="Confirm" ng-disabled="registerMode === 'preview' || !allRegistrantsValid() || submittingRegistration">
      <span ng-show="registerMode === 'preview'">&laquo; Disabled in preview mode</span>
    </section>
    <section class="text-center spacing-above-md" ng-if="currentRegistration.completed">
        <input type="button" class="btn btn-primary" onClick="window.print();" value="Print this page">
    </section>
  </div>
</div>
